å¥½çš„ï¼æˆ‘ç»™ä½ åˆ—ä¸€ä¸ªè¯¦ç»†çš„ **å‰åç«¯è¿è¡Œç¯å¢ƒæ­å»ºæŒ‡å—**ï¼Œä¸€æ­¥æ­¥æ¥ï¼Œå¸®ä½ å¿«é€Ÿå¯åŠ¨é¡¹ç›®ï¼Œæ–¹ä¾¿å¼€å‘å’Œè°ƒè¯•ã€‚

---

# ğŸ›  å‰åç«¯è¿è¡Œç¯å¢ƒæ­å»ºæŒ‡å—ï¼ˆFastAPI + React + Celery + Redisï¼‰

---

## 1. å‡†å¤‡ç¯å¢ƒ

* **Python 3.11+**
* **Node.js 18+**
* **Redis**ï¼ˆå¯ä»¥æœ¬åœ°è£…ï¼Œä¹Ÿå¯ä»¥ç”¨ Docker å®¹å™¨ï¼‰

---

## 2. åç«¯ FastAPI ç¯å¢ƒæ­å»º

### 2.1 å®‰è£… Python ä¾èµ–

```bash
cd backend
python3 -m venv venv
source venv/bin/activate      # Windows ç”¨ `venv\Scripts\activate`
pip install --upgrade pip
pip install -r requirements.txt
```

### 2.2 è¿è¡Œ FastAPI æœåŠ¡

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

æœåŠ¡é»˜è®¤ç›‘å¬ 8000 ç«¯å£ï¼Œæ”¯æŒçƒ­é‡è½½ã€‚

---

## 3. Redis æœåŠ¡å¯åŠ¨

### 3.1 æœ¬åœ°å®‰è£… Redis

* **Linux/macOS**ï¼šç”¨ç³»ç»ŸåŒ…ç®¡ç†å™¨å®‰è£…ï¼Œå¦‚ `apt install redis-server` æˆ– `brew install redis`
* **Windows**ï¼šå¯ç”¨ Redis for Windows ç‰ˆæœ¬ï¼Œæˆ–ç”¨ Docker è¿è¡Œ

### 3.2 ç”¨ Docker å¯åŠ¨ Redis å®¹å™¨ï¼ˆæ¨èï¼‰

```bash
docker run -d -p 6379:6379 --name redis redis
```

---

## 4. Celery Worker å¯åŠ¨

ç¡®ä¿ Redis æ­£å¸¸è¿è¡Œåï¼š

```bash
cd backend
source venv/bin/activate
celery -A app.tasks.worker worker --loglevel=info
```

è¿™æ · Celery ä¼šç›‘å¬ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¤„ç†ä¸Šä¼ çš„è§†é¢‘è½¬æ¢ä»»åŠ¡ã€‚

---

## 5. å‰ç«¯ React ç¯å¢ƒæ­å»º

### 5.1 å®‰è£…ä¾èµ–

```bash
cd frontend
npm install
```

### 5.2 è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

Vite é»˜è®¤å¯åŠ¨åœ¨ç«¯å£ 5173ï¼Œæµè§ˆå™¨æ‰“å¼€ `http://localhost:5173` å³å¯è®¿é—®ã€‚

**æ³¨æ„**ï¼šå‰ç«¯å·²é…ç½®ä»£ç†è½¬å‘ `/upload`, `/status`, `/result` è¯·æ±‚åˆ°åç«¯ 8000 ç«¯å£ï¼Œæ— éœ€è·¨åŸŸè®¾ç½®ã€‚

---

## 6. è®¿é—®æµç¨‹æµ‹è¯•

* æµè§ˆå™¨æ‰“å¼€å‰ç«¯é¡µé¢
* ä¸Šä¼ è§†é¢‘ + é…ç½®å˜é€Ÿ/æŠ½å¸§å‚æ•°ï¼Œæäº¤ä»»åŠ¡
* ç‚¹å‡»â€œæŸ¥è¯¢çŠ¶æ€â€æŸ¥çœ‹è§†é¢‘å¤„ç†è¿›åº¦
* å¤„ç†å®Œæˆåæ’­æ”¾å’Œä¸‹è½½ç”Ÿæˆè§†é¢‘

---

## 7. å¯èƒ½é‡åˆ°çš„ç¯å¢ƒé—®é¢˜åŠè§£å†³

| é—®é¢˜                | è§£å†³æ–¹æ¡ˆ                                                                                               |
| ----------------- | -------------------------------------------------------------------------------------------------- |
| FFmpeg æœªå®‰è£…æˆ–è·¯å¾„æ‰¾ä¸åˆ°  | å®‰è£… FFmpegï¼ŒLinux/macOSï¼š`sudo apt install ffmpeg`ï¼ŒmacOSï¼š`brew install ffmpeg`ï¼ŒWindowsï¼šä¸‹è½½å®‰è£…åŒ…å¹¶é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ |
| Redis è¿æ¥ä¸ä¸Š        | ç¡®è®¤ Redis æœåŠ¡å¯åŠ¨ï¼Œç«¯å£æ— å ç”¨ï¼Œé˜²ç«å¢™å…è®¸è®¿é—®                                                                        |
| Celery æ— æ³•è¿æ¥ Redis | æ£€æŸ¥ Celery é…ç½®çš„ broker URL æ˜¯å¦æ­£ç¡®ï¼Œæ¯”å¦‚ `redis://localhost:6379/0`                                        |
| Node ç‰ˆæœ¬è¿‡ä½å¯¼è‡´ä¾èµ–å®‰è£…å¤±è´¥ | æ›´æ–° Node.js è‡³ 18 ä»¥ä¸Šç‰ˆæœ¬                                                                               |
| è·¨åŸŸè¯·æ±‚å¤±è´¥            | ç¡®è®¤å‰ç«¯ä»£ç†é…ç½®æ­£ç¡®æˆ–åç«¯å…è®¸è·¨åŸŸï¼ˆFastAPI å¯ä½¿ç”¨ `fastapi.middleware.cors.CORSMiddleware`ï¼‰                            |

---

## 8. å¯é€‰ï¼šFastAPI å¯ç”¨ CORS ä¸­é—´ä»¶ç¤ºä¾‹

```python
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # æˆ–å¡«å†™å…·ä½“å‰ç«¯åœ°å€ï¼Œå¦‚ http://localhost:5173
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

å¦‚æœéœ€è¦æˆ‘å¸®ä½ å†™ä¸€ä»½æ›´è¯¦ç»†çš„è¿è¡Œè„šæœ¬æˆ–é…ç½®è¯´æ˜ï¼Œæˆ–è€…å¸®ä½ å†™ docker-compose æœ¬åœ°å¼€å‘ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼
